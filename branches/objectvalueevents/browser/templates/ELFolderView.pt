<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">
<body>

<div metal:fill-slot="main">
  <div  tal:define="only_for_editor python:checkPermission('Change portal events', context);">
  <h1 tal:content="context/Title">Events</h1>

  <p i18n:translate="">
  In this context, you can create, edit and manage event workflow. You can also navigate to event registrations to accept or reject applications.
  </p>

  <p tal:condition="only_for_editor">
  <a href=""
    tal:attributes="href string:${context/absolute_url}/createObject?type_name=ELEvent"
    i18n:translate="create_event">Create a New Event</a>
  </p>

  <h2 i18n:translate="event_list">Current Events</h2>
  <tal:events 
      tal:define="events python:context.getEvents(filter='current')">
    <table tal:condition="events" class="listing">
      <thead>
        <tr>
          <th i18n:translate="event_title">Title</th>
          <th i18n:translate="event_date">Dates</th>
          <th i18n:translate="event_venue">Venue</th>
          <th tal:condition="only_for_editor"
              i18n:translate="manage_event">Manage Event</th>
          <th tal:condition="only_for_editor"
              i18n:translate="registrations">Registrations</th>
        </tr>
      </thead>
      <tbody>
        <tr tal:repeat="event events">
          <td>
            <a href=""
              tal:attributes="href string:${event/absolute_url}/view"
              tal:content="event/Title">event title</a>
          </td>
          <td tal:define="
                dates python:'%s - %s' % (
                  context.toLocalizedTime(event.getStartDate(), long_format=1),
                  context.toLocalizedTime(event.getEndDate(), long_format=1))"
              tal:content="dates">date</td>
          <td>
             <span tal:content="event/getVenueName">event venue</span>
          </td>
          <td tal:define="eventview nocall:event/@@view_el_event"
              tal:condition="only_for_editor">
            <a href="edit"
              tal:attributes="href string:${event/absolute_url}/edit"
              i18n:translate="edit_event">Edit</a>
            <br />
            <a tal:attributes="href string:${event/absolute_url}/delete_confirmation"
              i18n:translate="delete_event">Delete</a>
            <br />
            <tal:actions 
                tal:repeat="action eventview/getNextWorkflowActions">
              <a tal:attributes="href action/url"
                 tal:condition="python:action['category'] == 'workflow'"
                 tal:content="action/name">workflow action</a>
              <br />
            </tal:actions>
          </td>
          <td tal:condition="only_for_editor">
            <a href=""
              tal:attributes="href string:${event/absolute_url}/@@view_registrations"
              i18n:translate="view_registrations">View and Manage Registrations</a>
          </td>
        </tr>
      </tbody>
    </table>

    <p tal:condition="not:events" i18n:translate="">
    There are no events.
    </p>
  </tal:events>

  <h2 i18n:translate="event_list">Past Events</h2>
  <tal:events 
      tal:define="events python:context.getEvents(filter='past', reverse=True)">
    <table tal:condition="events" class="listing">
      <thead>
        <tr>
          <th i18n:translate="event_title">Title</th>
          <th i18n:translate="event_date">Dates</th>
          <th i18n:translate="event_venue">Venue</th>
          <th tal:condition="only_for_editor"
              i18n:translate="manage_event">Manage Event</th>
          <th tal:condition="only_for_editor"
              i18n:translate="registrations">Registrations</th>
        </tr>
      </thead>
      <tbody>
        <tr tal:repeat="event events">
          <td>
            <a href=""
              tal:attributes="href string:${event/absolute_url}/view"
              tal:content="event/Title">event title</a>
          </td>
          <td tal:define="
                dates python:'%s <br/>- %s' % (
                  context.toLocalizedTime(event.getStartDate(), long_format=1),
                  context.toLocalizedTime(event.getEndDate(), long_format=1))"
              tal:content="structure dates">date</td>
          <td>
             <span tal:content="event/getVenueName">event venue</span>
          </td>
          <td tal:define="eventview nocall:event/@@view_el_event"
              tal:condition="only_for_editor">
            <a href="edit"
              tal:attributes="href string:${event/absolute_url}/edit"
              i18n:translate="edit_event">Edit</a>
            <br />
            <a tal:attributes="href string:${event/absolute_url}/delete_confirmation"
              i18n:translate="delete_event">Delete</a>
            <br />
            <tal:actions 
                tal:repeat="action eventview/getNextWorkflowActions">
              <a tal:attributes="href action/url"
                 tal:condition="python:action['category'] == 'workflow'"
                 tal:content="action/name">workflow action</a>
              <br />
            </tal:actions>
          </td>
          <td tal:condition="only_for_editor">
            <a href=""
              tal:attributes="href string:${event/absolute_url}/@@view_registrations"
              i18n:translate="view_registrations">View and Manage Registrations</a>
          </td>
        </tr>
      </tbody>
    </table>

  <p tal:condition="not:events" i18n:translate="">
  There are no events.
  </p>
  </tal:events>
  </div>
</div>

</body>
</html>
